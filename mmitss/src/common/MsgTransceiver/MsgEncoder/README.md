
# Message-Encoder
The Message-Encoder is a common (vehicle and roadside) components that translates messages created by MMITSS components into message packets and sends such message packets to DSRC Devices for wireless broadcast.

## Work-flow
Once Message-Encoder receives JSON strings of BSM, SRM, SSM, or SPAT messages, it first encodes them into a UPER payload. For MAP messages, it expects a readymade payload developed using [USDOT ISD Message Creator](https://webapp.connectedvcs.com/isd/). Upon generating or receiving a payload, Message-Encoder creates a [USDOT/FHWA Roadside Unit Specifications 4.1](https://cflsmartroads.com/projects/CV_Testing/USDOT%20RSU%20Specification%204%201_Final_R1.pdf) compliant message packet, and sends it to the DSRC Device (RSU or OBU) at standard UDP port 1516. An example of such message packet generated by Message-Encoder is provided below:
```
Version=0.7
Type=BSM
PSID=0x8002
Priority=7
TxMode=CONT
TxChannel=172
TxInterval='0'
DeliveryStart=
DeliveryStop=
Signature=False
Encryption=False
Payload=<DSRC message payload>
```
## Console output and logging
Message-Encoder does not produce any console outputs or log files.

## Requirements
1. As per the [USDOT/FHWA Roadside Unit Specifications 4.1](https://cflsmartroads.com/projects/CV_Testing/USDOT%20RSU%20Specification%204%201_Final_R1.pdf), RSUs must be configured to listen to the messages at UDP Port 1516, and broadcast the messages received on this port over the wireless network. MMITSS requires OBUs to comply with the same specifications too.
2. Undisrupted physical network connection between the RSU/OBU and the corresponding coprocessor (MRP/VSP)

## Configuration
In the `mmitss-phase3-master-config.json` file, following fields must be configured:
1. Common to both, vehicle and roadside deployments:
  - `["HostIp"]`: a `string` specifying the IP address of the host processor of the Host-BSM-Decoder (vehicleside coprocessor)
  - `["SourceDsrcDeviceIp"]`: a `string` specifying the IP address of the Dsrc Device (RSU or OBU) corresponding the host coprocessor
  - `["PortNumber"]["MessageTransceiver"]["MessageEncoder"]`: an `int` specifying the UDP port number to be used by the Message-Encoder
  - `["PortNumber"]["DsrcImmediateForwarder"]`: an `int` specifying the UDP port number where RSU listens for messages for immediate-forwarding (standard: 1516)
  - `["PortNumber"]["DataCollector"]`: an `int` specifying the UDP port number used by the V2X-Data-Collector
2. Roadside deployments only:
  - `["msgId"]["spat"]`: a `string` specifying the message ID (hex) of SPAT, which is currently: `0013`
  - `["msgId"]["map"]`: a `string` specifying the message ID (hex) of MAP, which is currently: `0012`
  - `["msgId"]["ssm_lower"]`: a `string` specifying the message ID of SSM (hex) in lower case, which is currently: `001d`
  - `["msgId"]["ssm_upper"]`: a `string` specifying the message ID of SSM (hex) in upper case, which is currently: `001D`
  - `["psid"]["spat"]`: a `string` specifying the PSID used for SRM by MMITSS, which is currently: `0x8002`
  - `["psid"]["map"]`: a `string` specifying the PSID used for MAP by MMITSS, which is currently: `0x8002`
  - `["psid"]["ssm"]`: a `string` specifying the PSID used for SSM by MMITSS, which is currently: `0x8002`
  - `["TxChannel"]["spat"]`: an `int` specifying the TX channel to be used for SPAT, which is currently: `172`
  - `["TxChannel"]["map"]`: an `int` specifying the TX channel to be used for MAP, which is currently: `172`
  - `["TxChannel"]["ssm"]`: an `int` specifying the TX channel to be used for SSM, which is currently: `182`
  - `["TxMode"]["spat"]`: a `string` specifying the Tx mode used for SPAT by MMITSS, which is currently: `CONT` (Continuous)
  - `["TxMode"]["map"]`: a `string` specifying the Tx mode used for MAP by MMITSS, which is currently: `CONT` (Continuous)
  - `["TxMode"]["ssm"]`: a `string` specifying the Tx mode used for SSM by MMITSS, which is currently: `ALT` (Alternating)
3. Vehicleside deployments only:
  - `["msgId"]["bsm"]`: a `string` specifying the message ID (hex) of BSM, which is currently: `0014`
  - `["msgId"]["srm_lower"]`: a `string` specifying the message ID of SRM (hex) in lower case, which is currently: `001e`
  - `["msgId"]["srm_upper"]`: a `string` specifying the message ID of SRM (hex) in upper case, which is currently: `001E`
  - `["psid"]["bsm"]`: a `string` specifying the PSID used for BSM by MMITSS, which is currently: `0x20`
  - `["psid"]["srm"]`: a `string` specifying the PSID used for SRM by MMITSS, which is currently: `0x8002`
  - `["TxChannel"]["bsm"]`: an `int` specifying the TX channel to be used for BSM, which is currently: `172`
  - `["TxChannel"]["srm"]`: an `int` specifying the TX channel to be used for SRM, which is currently: `182`
  - `["TxMode"]["bsm"]`: a `string` specifying the Tx mode used for BSM by MMITSS, which is currently: `CONT` (Continuous)
  - `["TxMode"]["srm"]`: a `string` specifying the Tx mode used for SRM by MMITSS, which is currently: `ALT` (Alternating)

## Known issues/limitations
- None -
